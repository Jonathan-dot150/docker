# 1 - Service
services:
    ollama:
        image: ollama/ollama:latest
        ports:
           - "11434:11434"
        volumes:
           - ollama-data:/root/.ollama
        restart: unless-stopped
        networks:
           - lab_net


    others:
        build: ../others
        container_name: fastapi-others
        ports:
           - "5001:5000"
        environment:
           - DATABASE_URL=sqlite:///./data/chat.db
           - OLLAMA_URL=http://ollama:11434
        volumes:
           - others-data:/app/data
        depends_on:
           - ollama
        networks:
           - lab_net



# 2 - le nom du service souhaitee (N'importe quoi)
    web_experience:
       image: nginx:stable
       ports:
         - "8082:80"
       networks:
         - lab_net

       configs:
         - source: nginx_config
           target: /etc/nginx/conf.d/default.conf

       deploy:
          replicas: 3
          restart_policy:
              condition: on-failure
          update_config:
            parallelism: 1
            delay: 10s
          placement:
            constraints:
              - node.role == worker




volumes:
    ollama-data:
    others-data:


networks:
    lab_net:
